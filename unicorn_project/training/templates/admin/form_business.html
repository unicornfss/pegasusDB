{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<h3 class="mb-3">{{ title }}</h3>

<form method="post" class="mb-4">
  {% csrf_token %}
  <div class="row g-3">
    {% for field in form %}
      <div class="col-md-6">
        <label class="form-label">{{ field.label }}{% if field.field.required %} *{% endif %}</label>
        {{ field }}
        {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
        {% for err in field.errors %}<div class="text-danger small">{{ err }}</div>{% endfor %}
      </div>
    {% endfor %}
  </div>
  <div class="mt-3 d-flex gap-2">
    <a href="{{ back_url }}" class="btn btn-outline-secondary">Back</a>
    <button class="btn btn-primary" type="submit" name="save_continue" value="1">
      Save and continue editing
    </button>
    <button class="btn btn-success" type="submit" name="save_return" value="1">
      Save and return
    </button>
  </div>
</form>

{% if business %}
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h5 class="mb-0">Training locations for <strong>{{ business.name }}</strong></h5>
    {% if add_location_url %}
      <a class="btn btn-sm btn-success" href="{{ add_location_url }}">
        <i class="bi bi-plus-lg"></i> Add Location
      </a>
    {% endif %}
  </div>

  {% if locations %}
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Name</th>
          <th>Address</th>
          <th>Town</th>
          <th>Postcode</th>
          <th>Contact</th>
          <th style="width:1%"></th>
        </tr>
      </thead>
      <tbody>
      {% for loc in locations %}
        <tr>
          <td>{{ loc.name }}</td>
          <td>{{ loc.address_line }}</td>
          <td>{{ loc.town }}</td>
          <td>{{ loc.postcode }}</td>
          <td>
            {{ loc.contact_name }}<br>
            <span class="text-muted small">
              {{ loc.telephone }}{% if loc.email %} · {{ loc.email }}{% endif %}
            </span>
          </td>
          <td class="text-nowrap">
            <a class="btn btn-sm btn-outline-primary" href="{% url 'admin_location_edit' loc.id %}">
              <i class="bi bi-pencil"></i> Edit
            </a>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="text-muted">
      No training locations yet. Tick “Add as training location” and save to auto-create one,
      or click <em>Add Location</em> to create another.
    </div>
  {% endif %}
{% endif %}
{% endblock %}
