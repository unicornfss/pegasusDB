{% extends "base.html" %}
{% load static %}

{% block title %}{{ course_type.name }} — Exam {{ exam.exam_code|slice:"-2:" }} (Review){% endblock %}

{% block content %}
<div class="container" style="max-width: 900px;">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h5 mb-0">{{ course_type.name }} — Exam {{ exam.exam_code|slice:"-2:" }} — Full review</h1>
    {% if back_url %}
      <a class="btn btn-outline-secondary" href="{{ back_url }}">Back</a>
    {% endif %}
  </div>

  <div class="alert alert-light border d-flex align-items-center gap-3">
    <div><strong>Delegate:</strong> {{ display_name }}</div>
    <div><strong>DOB:</strong> {{ attempt.date_of_birth|date:"j M Y"|default:"—" }}</div>
    <div><strong>Exam date:</strong> {{ attempt.exam_date|date:"j M Y"|default:"—" }}</div>
    <div><strong>Score:</strong> {{ correct_count }}/{{ total_questions }}</div>
    <div><strong>Result:</strong>
      {% if result_class == "success" %}
        <span class="badge bg-success">{{ result_label }}</span>
      {% elif result_class == "warning" %}
        <span class="badge bg-warning text-dark">{{ result_label }}</span>
      {% else %}
        <span class="badge bg-danger">{{ result_label }}</span>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <div class="card-header">All responses</div>
    <ol class="list-group list-group-numbered list-group-flush">
      {% for aa in answers %}
        <li class="list-group-item">
          <div class="mb-2">
            <strong>Q{{ forloop.counter }}.</strong> {{ aa.question.text }}
          </div>

          <div class="d-flex align-items-center gap-2">
            <span class="badge {% if aa.is_correct %}bg-success{% else %}bg-danger{% endif %}">
              {% if aa.is_correct %}Correct{% else %}Incorrect{% endif %}
            </span>
            <span><strong>Chosen:</strong> {{ aa.answer.text }}</span>
          </div>

          {# Optional: show the other choices #}
          {% if aa.question.answers.exists %}
            <div class="mt-2 small text-muted">
              <strong>Other options:</strong>
              {% for opt in aa.question.answers.all %}
                {% if opt.id != aa.answer_id %}
                  <span class="me-2">{{ opt.text }}</span>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ol>
  </div>

</div>
{% endblock %}
