{# unicorn_project/training/templates/instructor/bookings.html #}
{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block content %}
<h3 class="mb-3">{{ title }}</h3>
<p class="text-muted">Hello {{ instructor.name|default:request.user.get_username }}.</p>

{# --- In progress --- #}
<h5 class="mt-3 d-flex align-items-center gap-2">
  In progress
  {% if in_progress %}<span class="badge bg-dark">{{ in_progress|length }}</span>{% endif %}
</h5>
{% if in_progress %}
  <div class="table-responsive mb-3">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Date</th>
          <th>Start</th>
          <th>Course</th>
          <th>Business</th>
          <th>Location</th>
        </tr>
      </thead>
      <tbody>
        {% for b in in_progress %}
          {% url 'instructor_booking_detail' b.id as detail_url %}
          <tr class="click-row" data-href="{{ detail_url }}">
            <td>{{ b.course_date }}</td>
            <td>{% if b.start_time %}{{ b.start_time|time:"H:i" }}{% else %}—{% endif %}</td>
            <td><a href="{{ detail_url }}" class="text-decoration-none">{{ b.course_type.name }}</a></td>
            <td>{{ b.business.name }}</td>
            <td>{{ b.training_location.name|default:"—" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="text-muted mb-3">No courses currently in progress.</div>
{% endif %}

{# --- Awaiting instructor closure --- #}
<h5 class="mt-3 d-flex align-items-center gap-2">
  Awaiting instructor closure
  {% if awaiting %}<span class="badge" style="background-color:#6f42c1;color:#fff">{{ awaiting|length }}</span>{% endif %}
</h5>
{% if awaiting %}
  <div class="table-responsive mb-3">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Date</th>
          <th>Start</th>
          <th>Course</th>
          <th>Business</th>
          <th>Location</th>
        </tr>
      </thead>
      <tbody>
        {% for b in awaiting %}
          {% url 'instructor_booking_detail' b.id as detail_url %}
          <tr class="click-row" data-href="{{ detail_url }}">
            <td>{{ b.course_date }}</td>
            <td>{% if b.start_time %}{{ b.start_time|time:"H:i" }}{% else %}—{% endif %}</td>
            <td><a href="{{ detail_url }}" class="text-decoration-none">{{ b.course_type.name }}</a></td>
            <td>{{ b.business.name }}</td>
            <td>{{ b.training_location.name|default:"—" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="text-muted mb-3">Nothing awaiting closure.</div>
{% endif %}

{# --- Scheduled (max 10) --- #}
<h5 class="mt-3 d-flex align-items-center gap-2">
  Scheduled (next up to 10)
  {% if scheduled %}<span class="badge bg-info text-dark">{{ scheduled|length }}</span>{% endif %}
</h5>
{% if scheduled %}
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>Date</th>
          <th>Start</th>
          <th>Course</th>
          <th>Business</th>
          <th>Location</th>
        </tr>
      </thead>
      <tbody>
        {% for b in scheduled %}
          {% url 'instructor_booking_detail' b.id as detail_url %}
          <tr class="click-row" data-href="{{ detail_url }}">
            <td>{{ b.course_date }}</td>
            <td>{% if b.start_time %}{{ b.start_time|time:"H:i" }}{% else %}—{% endif %}</td>
            <td><a href="{{ detail_url }}" class="text-decoration-none">{{ b.course_type.name }}</a></td>
            <td>{{ b.business.name }}</td>
            <td>{{ b.training_location.name|default:"—" }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="text-muted">No upcoming scheduled courses.</div>
{% endif %}

<script>
  // Make entire row clickable, but don't swallow clicks on real links/buttons
  document.addEventListener('click', function (e) {
    const row = e.target.closest('tr.click-row');
    if (!row) return;
    if (e.target.closest('a,button')) return;
    const href = row.getAttribute('data-href');
    if (href) window.location.href = href;
  });
</script>
{% endblock %}
